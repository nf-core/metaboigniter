/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Config file for defining DSL2 per module options and publishing paths
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Available keys to override module options:
        ext.args   = Additional arguments appended to command in module.
        ext.args2  = Second set of arguments appended to command in module (multi-tool modules).
        ext.args3  = Third set of arguments appended to command in module (multi-tool modules).
        ext.prefix = File name prefix for output files.
----------------------------------------------------------------------------------------
*/

process {

    publishDir = [
        path: { "${params.outdir}/${task.process.tokenize(':')[-1].tokenize('_')[0].toLowerCase()}" },
        mode: params.publish_dir_mode,
        saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
    ]

    withName: CUSTOM_DUMPSOFTWAREVERSIONS {
        publishDir = [
            path: { "${params.outdir}/pipeline_info" },
            mode: params.publish_dir_mode,
            pattern: '*_versions.yml'
        ]
    }
    withName: 'OPENMS_PEAKPICKERHIRES' {
                ext.args   = {
                    [

                        params.algorithm_signal_to_noise_peakpickerhires_openms ? "-algorithm:signal_to_noise $params.algorithm_signal_to_noise_peakpickerhires_openms":'',
                        params.algorithm_spacing_difference_gap_peakpickerhires_openms ? "-algorithm:spacing_difference_gap $params.algorithm_spacing_difference_gap_peakpickerhires_openms":'',
                        params.algorithm_spacing_difference_peakpickerhires_openms ? "-algorithm:spacing_difference $params.algorithm_spacing_difference_peakpickerhires_openms":'',
                        params.algorithm_missing_peakpickerhires_openms ? "-algorithm:missing $params.algorithm_missing_peakpickerhires_openms":'',
                        params.algorithm_report_fwhm_peakpickerhires_openms ? "-algorithm:report_FWHM":'',
                        params.algorithm_report_fwhm_unit_peakpickerhires_openms ? "-algorithm:report_FWHM_unit $params.algorithm_report_fwhm_unit_peakpickerhires_openms":'',
                        params.algorithm_signaltonoise_max_intensity_peakpickerhires_openms ? "-algorithm:SignalToNoise:max_intensity $params.algorithm_signaltonoise_max_intensity_peakpickerhires_openms":'',
                        params.algorithm_signaltonoise_auto_max_stdev_factor_peakpickerhires_openms ? "-algorithm:SignalToNoise:auto_max_stdev_factor $params.algorithm_signaltonoise_auto_max_stdev_factor_peakpickerhires_openms":'',
                        params.algorithm_signaltonoise_auto_max_percentile_peakpickerhires_openms ? "-algorithm:SignalToNoise:auto_max_percentile $params.algorithm_signaltonoise_auto_max_percentile_peakpickerhires_openms":'',
                        params.algorithm_signaltonoise_auto_mode_peakpickerhires_openms ? "-algorithm:SignalToNoise:auto_mode $params.algorithm_signaltonoise_auto_mode_peakpickerhires_openms":'',
                        params.algorithm_signaltonoise_win_len_peakpickerhires_openms ? "-algorithm:SignalToNoise:win_len $params.algorithm_signaltonoise_win_len_peakpickerhires_openms":'',
                        params.algorithm_signaltonoise_bin_count_peakpickerhires_openms ? "-algorithm:SignalToNoise:bin_count $params.algorithm_signaltonoise_bin_count_peakpickerhires_openms":'',
                        params.algorithm_signaltonoise_min_required_elements_peakpickerhires_openms ? "-algorithm:SignalToNoise:min_required_elements $params.algorithm_signaltonoise_min_required_elements_peakpickerhires_openms":'',
                        params.algorithm_signaltonoise_noise_for_empty_window_peakpickerhires_openms ? "-algorithm:SignalToNoise:noise_for_empty_window $params.algorithm_signaltonoise_noise_for_empty_window_peakpickerhires_openms":'',
                ].flatten().unique(false).join(' ').trim()
                }
                ext.prefix = { "${meta.id}" }

                    publishDir = [
                    path: { "${params.outdir}/centroided/${meta.id}" },
                    enabled: true
                ]

    }
    withName: 'OPENMS_FEATUREFINDERMETABO' {
                ext.args   = {
                    [

                        params.algorithm_common_noise_threshold_int_featurefindermetabo_openms ? "-algorithm:common:noise_threshold_int $params.algorithm_common_noise_threshold_int_featurefindermetabo_openms":'',
                        params.algorithm_common_chrom_peak_snr_featurefindermetabo_openms ? "-algorithm:common:chrom_peak_snr $params.algorithm_common_chrom_peak_snr_featurefindermetabo_openms":'',
                        params.algorithm_common_chrom_fwhm_featurefindermetabo_openms ? "-algorithm:common:chrom_fwhm $params.algorithm_common_chrom_fwhm_featurefindermetabo_openms":'',
                        params.algorithm_mtd_mass_error_ppm_featurefindermetabo_openms ? "-algorithm:mtd:mass_error_ppm $params.algorithm_mtd_mass_error_ppm_featurefindermetabo_openms":'',
                        "-algorithm:mtd:reestimate_mt_sd $params.algorithm_mtd_reestimate_mt_sd_featurefindermetabo_openms", // some parameters are in this format because openms is not consistent with boolean values. sometime they use string sometime they use boolean!
                        params.algorithm_mtd_quant_method_featurefindermetabo_openms ? "-algorithm:mtd:quant_method $params.algorithm_mtd_quant_method_featurefindermetabo_openms":'',
                        params.algorithm_mtd_trace_termination_criterion_featurefindermetabo_openms ? "-algorithm:mtd:trace_termination_criterion $params.algorithm_mtd_trace_termination_criterion_featurefindermetabo_openms":'',
                        params.algorithm_mtd_trace_termination_outliers_featurefindermetabo_openms ? "-algorithm:mtd:trace_termination_outliers $params.algorithm_mtd_trace_termination_outliers_featurefindermetabo_openms":'',
                        params.algorithm_mtd_min_sample_rate_featurefindermetabo_openms ? "-algorithm:mtd:min_sample_rate $params.algorithm_mtd_min_sample_rate_featurefindermetabo_openms":'',
                        params.algorithm_mtd_min_trace_length_featurefindermetabo_openms ? "-algorithm:mtd:min_trace_length $params.algorithm_mtd_min_trace_length_featurefindermetabo_openms":'',
                        params.algorithm_mtd_max_trace_length_featurefindermetabo_openms ? "-algorithm:mtd:max_trace_length $params.algorithm_mtd_max_trace_length_featurefindermetabo_openms":'',
                        "-algorithm:epd:enabled $params.algorithm_epd_enabled_featurefindermetabo_openms",
                        params.algorithm_epd_width_filtering_featurefindermetabo_openms ? "-algorithm:epd:width_filtering $params.algorithm_epd_width_filtering_featurefindermetabo_openms":'',
                        params.algorithm_epd_min_fwhm_featurefindermetabo_openms ? "-algorithm:epd:min_fwhm $params.algorithm_epd_min_fwhm_featurefindermetabo_openms":'',
                        params.algorithm_epd_max_fwhm_featurefindermetabo_openms ? "-algorithm:epd:max_fwhm $params.algorithm_epd_max_fwhm_featurefindermetabo_openms":'',
                        params.algorithm_epd_masstrace_snr_filtering_featurefindermetabo_openms ? "-algorithm:epd:masstrace_snr_filtering":'',
                        params.algorithm_ffm_local_rt_range_featurefindermetabo_openms ? "-algorithm:ffm:local_rt_range $params.algorithm_ffm_local_rt_range_featurefindermetabo_openms":'',
                        params.algorithm_ffm_local_mz_range_featurefindermetabo_openms ? "-algorithm:ffm:local_mz_range $params.algorithm_ffm_local_mz_range_featurefindermetabo_openms":'',
                        params.algorithm_ffm_charge_lower_bound_featurefindermetabo_openms ? "-algorithm:ffm:charge_lower_bound $params.algorithm_ffm_charge_lower_bound_featurefindermetabo_openms":'',
                        params.algorithm_ffm_charge_upper_bound_featurefindermetabo_openms ? "-algorithm:ffm:charge_upper_bound $params.algorithm_ffm_charge_upper_bound_featurefindermetabo_openms":'',
                        "-algorithm:ffm:report_summed_ints $params.algorithm_ffm_report_summed_ints_featurefindermetabo_openms",
                        "-algorithm:ffm:enable_RT_filtering $params.algorithm_ffm_enable_rt_filtering_featurefindermetabo_openms",
                        params.algorithm_ffm_isotope_filtering_model_featurefindermetabo_openms ? "-algorithm:ffm:isotope_filtering_model $params.algorithm_ffm_isotope_filtering_model_featurefindermetabo_openms":'',
                        "-algorithm:ffm:mz_scoring_13C $params.algorithm_ffm_mz_scoring_13c_featurefindermetabo_openms",
                        "-algorithm:ffm:use_smoothed_intensities $params.algorithm_ffm_use_smoothed_intensities_featurefindermetabo_openms",
                        "-algorithm:ffm:report_convex_hulls $params.algorithm_ffm_report_convex_hulls_featurefindermetabo_openms",
                        "-algorithm:ffm:remove_single_traces $params.algorithm_ffm_remove_single_traces_featurefindermetabo_openms",
                        "-algorithm:ffm:mz_scoring_by_elements $params.algorithm_ffm_mz_scoring_by_elements_featurefindermetabo_openms",
                        params.algorithm_ffm_elements_featurefindermetabo_openms ? "-algorithm:ffm:elements $params.algorithm_ffm_elements_featurefindermetabo_openms":''
                ].flatten().unique(false).join(' ').trim()

                }
                ext.prefix = { "${meta.id}" }

                    publishDir = [
                    path: { "${params.outdir}/quantification/${meta.id}" },
                    enabled: true
                ]

            }


                withName: 'OPENMS_MAPALIGNERPOSECLUSTERING' {
                ext.args   = {
                    [


                        params.algorithm_max_num_peaks_considered_mapalignerposeclustering_openms ? "-algorithm:max_num_peaks_considered $params.algorithm_max_num_peaks_considered_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_mz_pair_max_distance_mapalignerposeclustering_openms ? "-algorithm:superimposer:mz_pair_max_distance $params.algorithm_superimposer_mz_pair_max_distance_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_rt_pair_distance_fraction_mapalignerposeclustering_openms ? "-algorithm:superimposer:rt_pair_distance_fraction $params.algorithm_superimposer_rt_pair_distance_fraction_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_num_used_points_mapalignerposeclustering_openms ? "-algorithm:superimposer:num_used_points $params.algorithm_superimposer_num_used_points_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_scaling_bucket_size_mapalignerposeclustering_openms ? "-algorithm:superimposer:scaling_bucket_size $params.algorithm_superimposer_scaling_bucket_size_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_shift_bucket_size_mapalignerposeclustering_openms ? "-algorithm:superimposer:shift_bucket_size $params.algorithm_superimposer_shift_bucket_size_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_max_shift_mapalignerposeclustering_openms ? "-algorithm:superimposer:max_shift $params.algorithm_superimposer_max_shift_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_max_scaling_mapalignerposeclustering_openms ? "-algorithm:superimposer:max_scaling $params.algorithm_superimposer_max_scaling_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_dump_buckets_mapalignerposeclustering_openms ? "-algorithm:superimposer:dump_buckets $params.algorithm_superimposer_dump_buckets_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_dump_pairs_mapalignerposeclustering_openms ? "-algorithm:superimposer:dump_pairs $params.algorithm_superimposer_dump_pairs_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_second_nearest_gap_mapalignerposeclustering_openms ? "-algorithm:pairfinder:second_nearest_gap $params.algorithm_pairfinder_second_nearest_gap_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_use_identifications_mapalignerposeclustering_openms ? "-algorithm:pairfinder:use_identifications":'',
                        params.algorithm_pairfinder_ignore_charge_mapalignerposeclustering_openms ? "-algorithm:pairfinder:ignore_charge":'',
                        "-algorithm:pairfinder:ignore_adduct $params.algorithm_pairfinder_ignore_adduct_mapalignerposeclustering_openms",
                        params.algorithm_pairfinder_distance_rt_max_difference_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_RT:max_difference $params.algorithm_pairfinder_distance_rt_max_difference_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_rt_exponent_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_RT:exponent $params.algorithm_pairfinder_distance_rt_exponent_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_rt_weight_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_RT:weight $params.algorithm_pairfinder_distance_rt_weight_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_mz_max_difference_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_MZ:max_difference $params.algorithm_pairfinder_distance_mz_max_difference_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_mz_unit_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_MZ:unit $params.algorithm_pairfinder_distance_mz_unit_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_mz_exponent_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_MZ:exponent $params.algorithm_pairfinder_distance_mz_exponent_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_mz_weight_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_MZ:weight $params.algorithm_pairfinder_distance_mz_weight_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_intensity_exponent_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_intensity:exponent $params.algorithm_pairfinder_distance_intensity_exponent_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_intensity_weight_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_intensity:weight $params.algorithm_pairfinder_distance_intensity_weight_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_intensity_log_transform_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_intensity:log_transform $params.algorithm_pairfinder_distance_intensity_log_transform_mapalignerposeclustering_openms":''
                ].flatten().unique(false).join(' ').trim()

                }
                ext.prefix = { ${meta.id} }

                    publishDir = [
                    path: { "${params.outdir}/alignment/${meta.id}" },
                    enabled: true
                ]

            }
                withName: 'OPENMS_MAPALIGNERPOSECLUSTERINGMZML' {
                ext.args   = {
                    [
                        params.algorithm_max_num_peaks_considered_mapalignerposeclustering_openms ? "-algorithm:max_num_peaks_considered $params.algorithm_max_num_peaks_considered_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_mz_pair_max_distance_mapalignerposeclustering_openms ? "-algorithm:superimposer:mz_pair_max_distance $params.algorithm_superimposer_mz_pair_max_distance_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_rt_pair_distance_fraction_mapalignerposeclustering_openms ? "-algorithm:superimposer:rt_pair_distance_fraction $params.algorithm_superimposer_rt_pair_distance_fraction_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_num_used_points_mapalignerposeclustering_openms ? "-algorithm:superimposer:num_used_points $params.algorithm_superimposer_num_used_points_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_scaling_bucket_size_mapalignerposeclustering_openms ? "-algorithm:superimposer:scaling_bucket_size $params.algorithm_superimposer_scaling_bucket_size_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_shift_bucket_size_mapalignerposeclustering_openms ? "-algorithm:superimposer:shift_bucket_size $params.algorithm_superimposer_shift_bucket_size_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_max_shift_mapalignerposeclustering_openms ? "-algorithm:superimposer:max_shift $params.algorithm_superimposer_max_shift_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_max_scaling_mapalignerposeclustering_openms ? "-algorithm:superimposer:max_scaling $params.algorithm_superimposer_max_scaling_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_dump_buckets_mapalignerposeclustering_openms ? "-algorithm:superimposer:dump_buckets $params.algorithm_superimposer_dump_buckets_mapalignerposeclustering_openms":'',
                        params.algorithm_superimposer_dump_pairs_mapalignerposeclustering_openms ? "-algorithm:superimposer:dump_pairs $params.algorithm_superimposer_dump_pairs_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_second_nearest_gap_mapalignerposeclustering_openms ? "-algorithm:pairfinder:second_nearest_gap $params.algorithm_pairfinder_second_nearest_gap_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_use_identifications_mapalignerposeclustering_openms ? "-algorithm:pairfinder:use_identifications":'',
                        params.algorithm_pairfinder_ignore_charge_mapalignerposeclustering_openms ? "-algorithm:pairfinder:ignore_charge":'',
                        params.algorithm_pairfinder_ignore_adduct_mapalignerposeclustering_openms ? "-algorithm:pairfinder:ignore_adduct $params.algorithm_pairfinder_ignore_adduct_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_rt_max_difference_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_RT:max_difference $params.algorithm_pairfinder_distance_rt_max_difference_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_rt_exponent_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_RT:exponent $params.algorithm_pairfinder_distance_rt_exponent_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_rt_weight_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_RT:weight $params.algorithm_pairfinder_distance_rt_weight_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_mz_max_difference_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_MZ:max_difference $params.algorithm_pairfinder_distance_mz_max_difference_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_mz_unit_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_MZ:unit $params.algorithm_pairfinder_distance_mz_unit_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_mz_exponent_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_MZ:exponent $params.algorithm_pairfinder_distance_mz_exponent_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_mz_weight_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_MZ:weight $params.algorithm_pairfinder_distance_mz_weight_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_intensity_exponent_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_intensity:exponent $params.algorithm_pairfinder_distance_intensity_exponent_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_intensity_weight_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_intensity:weight $params.algorithm_pairfinder_distance_intensity_weight_mapalignerposeclustering_openms":'',
                        params.algorithm_pairfinder_distance_intensity_log_transform_mapalignerposeclustering_openms ? "-algorithm:pairfinder:distance_intensity:log_transform $params.algorithm_pairfinder_distance_intensity_log_transform_mapalignerposeclustering_openms":''
                ].flatten().unique(false).join(' ').trim()

                }
                ext.prefix = { ${meta.id} }

                    publishDir = [
                    path: { "${params.outdir}/alignment_mzml/${meta.id}" },
                    enabled: true
                ]

            }

            withName: 'OPENMS_MAPRTTRANSFORMER' {
                ext.args   = {
                    [



                    params.invert_maprttransformer_openms ? "-invert":'',
                    params.store_original_rt_maprttransformer_openms ? "-store_original_rt":'',
                    params.model_type_maprttransformer_openms ? "-model:type $params.model_type_maprttransformer_openms":'',
                    params.model_linear_symmetric_regression_maprttransformer_openms ? "-model:linear:symmetric_regression":'',
                    params.model_linear_x_weight_maprttransformer_openms ? "-model:linear:x_weight $params.model_linear_x_weight_maprttransformer_openms":'',
                    params.model_linear_y_weight_maprttransformer_openms ? "-model:linear:y_weight $params.model_linear_y_weight_maprttransformer_openms":'',
                    params.model_linear_x_datum_min_maprttransformer_openms ? "-model:linear:x_datum_min $params.model_linear_x_datum_min_maprttransformer_openms":'',
                    params.model_linear_x_datum_max_maprttransformer_openms ? "-model:linear:x_datum_max $params.model_linear_x_datum_max_maprttransformer_openms":'',
                    params.model_linear_y_datum_min_maprttransformer_openms ? "-model:linear:y_datum_min $params.model_linear_y_datum_min_maprttransformer_openms":'',
                    params.model_linear_y_datum_max_maprttransformer_openms ? "-model:linear:y_datum_max $params.model_linear_y_datum_max_maprttransformer_openms":'',
                    params.model_b_spline_wavelength_maprttransformer_openms ? "-model:b_spline:wavelength $params.model_b_spline_wavelength_maprttransformer_openms":'',
                    params.model_b_spline_num_nodes_maprttransformer_openms ? "-model:b_spline:num_nodes $params.model_b_spline_num_nodes_maprttransformer_openms":'',
                    params.model_b_spline_extrapolate_maprttransformer_openms ? "-model:b_spline:extrapolate $params.model_b_spline_extrapolate_maprttransformer_openms":'',
                    params.model_b_spline_boundary_condition_maprttransformer_openms ? "-model:b_spline:boundary_condition $params.model_b_spline_boundary_condition_maprttransformer_openms":'',
                    params.model_lowess_span_maprttransformer_openms ? "-model:lowess:span $params.model_lowess_span_maprttransformer_openms":'',
                    params.model_lowess_num_iterations_maprttransformer_openms ? "-model:lowess:num_iterations $params.model_lowess_num_iterations_maprttransformer_openms":'',
                    params.model_lowess_delta_maprttransformer_openms ? "-model:lowess:delta $params.model_lowess_delta_maprttransformer_openms":'',
                    params.model_lowess_interpolation_type_maprttransformer_openms ? "-model:lowess:interpolation_type $params.model_lowess_interpolation_type_maprttransformer_openms":'',
                    params.model_lowess_extrapolation_type_maprttransformer_openms ? "-model:lowess:extrapolation_type $params.model_lowess_extrapolation_type_maprttransformer_openms":'',
                    params.model_interpolated_interpolation_type_maprttransformer_openms ? "-model:interpolated:interpolation_type $params.model_interpolated_interpolation_type_maprttransformer_openms":'',
                    params.model_interpolated_extrapolation_type_maprttransformer_openms ? "-model:interpolated:extrapolation_type $params.model_interpolated_extrapolation_type_maprttransformer_openms":''

                ].flatten().unique(false).join(' ').trim()

                }
                ext.prefix ={ "${meta.id}" }

                    publishDir = [
                    path: { "${params.outdir}/alignment_mzml/${meta.id}" },
                    enabled: true
                ]

            }


            withName: 'OPENMS_METABOLITEADDUCTDECHARGER' {
                ext.args   = {
                    [ params.polarity=="positive" ? "-algorithm:MetaboliteFeatureDeconvolution:potential_adducts $params.adducts_pos": "-algorithm:MetaboliteFeatureDeconvolution:potential_adducts $params.adducts_neg",

                    params.algorithm_metabolitefeaturedeconvolution_charge_min_metaboliteadductdecharger_openms ? "-algorithm:MetaboliteFeatureDeconvolution:charge_min $params.algorithm_metabolitefeaturedeconvolution_charge_min_metaboliteadductdecharger_openms":'',
                    params.algorithm_metabolitefeaturedeconvolution_charge_max_metaboliteadductdecharger_openms ? "-algorithm:MetaboliteFeatureDeconvolution:charge_max $params.algorithm_metabolitefeaturedeconvolution_charge_max_metaboliteadductdecharger_openms":'',
                    params.algorithm_metabolitefeaturedeconvolution_charge_span_max_metaboliteadductdecharger_openms ? "-algorithm:MetaboliteFeatureDeconvolution:charge_span_max $params.algorithm_metabolitefeaturedeconvolution_charge_span_max_metaboliteadductdecharger_openms":'',
                    params.algorithm_metabolitefeaturedeconvolution_q_try_metaboliteadductdecharger_openms ? "-algorithm:MetaboliteFeatureDeconvolution:q_try $params.algorithm_metabolitefeaturedeconvolution_q_try_metaboliteadductdecharger_openms":'',
                    params.algorithm_metabolitefeaturedeconvolution_retention_max_diff_metaboliteadductdecharger_openms ? "-algorithm:MetaboliteFeatureDeconvolution:retention_max_diff $params.algorithm_metabolitefeaturedeconvolution_retention_max_diff_metaboliteadductdecharger_openms":'',
                    params.algorithm_metabolitefeaturedeconvolution_retention_max_diff_local_metaboliteadductdecharger_openms ? "-algorithm:MetaboliteFeatureDeconvolution:retention_max_diff_local $params.algorithm_metabolitefeaturedeconvolution_retention_max_diff_local_metaboliteadductdecharger_openms":'',
                    params.algorithm_metabolitefeaturedeconvolution_mass_max_diff_metaboliteadductdecharger_openms ? "-algorithm:MetaboliteFeatureDeconvolution:mass_max_diff $params.algorithm_metabolitefeaturedeconvolution_mass_max_diff_metaboliteadductdecharger_openms":'',
                    params.algorithm_metabolitefeaturedeconvolution_unit_metaboliteadductdecharger_openms ? "-algorithm:MetaboliteFeatureDeconvolution:unit $params.algorithm_metabolitefeaturedeconvolution_unit_metaboliteadductdecharger_openms":'',
                    params.algorithm_metabolitefeaturedeconvolution_max_neutrals_metaboliteadductdecharger_openms ? "-algorithm:MetaboliteFeatureDeconvolution:max_neutrals $params.algorithm_metabolitefeaturedeconvolution_max_neutrals_metaboliteadductdecharger_openms":'',
                    "-algorithm:MetaboliteFeatureDeconvolution:use_minority_bound $params.algorithm_metabolitefeaturedeconvolution_use_minority_bound_metaboliteadductdecharger_openms",
                    params.algorithm_metabolitefeaturedeconvolution_max_minority_bound_metaboliteadductdecharger_openms ? "-algorithm:MetaboliteFeatureDeconvolution:max_minority_bound $params.algorithm_metabolitefeaturedeconvolution_max_minority_bound_metaboliteadductdecharger_openms":'',
                    params.algorithm_metabolitefeaturedeconvolution_min_rt_overlap_metaboliteadductdecharger_openms ? "-algorithm:MetaboliteFeatureDeconvolution:min_rt_overlap $params.algorithm_metabolitefeaturedeconvolution_min_rt_overlap_metaboliteadductdecharger_openms":'',
                    params.algorithm_metabolitefeaturedeconvolution_intensity_filter_metaboliteadductdecharger_openms ? "-algorithm:MetaboliteFeatureDeconvolution:intensity_filter":'', params.polarity=="negative" ? "-algorithm:MetaboliteFeatureDeconvolution:negative_mode":'',
                    params.algorithm_metabolitefeaturedeconvolution_default_map_label_metaboliteadductdecharger_openms ? "-algorithm:MetaboliteFeatureDeconvolution:default_map_label $params.algorithm_metabolitefeaturedeconvolution_default_map_label_metaboliteadductdecharger_openms":'',


                ].flatten().unique(false).join(' ').trim()

                }
                ext.prefix ={ "${meta.id}" }

                    publishDir = [
                    path: { "${params.outdir}/annotation/${meta.id}" },
                    enabled: true
                ]

            }
            withName: 'OPENMS_FEATURELINKERUNLABELEDKD' {
                ext.args   = {
                    [


                    params.keep_subelements_featurelinkerunlabeledkd_openms ? "-keep_subelements":'',
                    params.algorithm_mz_unit_featurelinkerunlabeledkd_openms ? "-algorithm:mz_unit $params.algorithm_mz_unit_featurelinkerunlabeledkd_openms":'',
                    params.parallel_linking ? "-algorithm:nr_partitions 1" : params.algorithm_nr_partitions_featurelinkerunlabeledkd_openms ? "-algorithm:nr_partitions $params.algorithm_nr_partitions_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_nr_partitions_featurelinkerunlabeledkd_openms ? "-algorithm:nr_partitions $params.algorithm_nr_partitions_featurelinkerunlabeledkd_openms":'',
                    "-algorithm:warp:enabled $params.algorithm_warp_enabled_featurelinkerunlabeledkd_openms",
                    params.algorithm_warp_rt_tol_featurelinkerunlabeledkd_openms ? "-algorithm:warp:rt_tol $params.algorithm_warp_rt_tol_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_warp_mz_tol_featurelinkerunlabeledkd_openms ? "-algorithm:warp:mz_tol $params.algorithm_warp_mz_tol_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_warp_max_pairwise_log_fc_featurelinkerunlabeledkd_openms ? "-algorithm:warp:max_pairwise_log_fc $params.algorithm_warp_max_pairwise_log_fc_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_warp_min_rel_cc_size_featurelinkerunlabeledkd_openms ? "-algorithm:warp:min_rel_cc_size $params.algorithm_warp_min_rel_cc_size_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_warp_max_nr_conflicts_featurelinkerunlabeledkd_openms ? "-algorithm:warp:max_nr_conflicts $params.algorithm_warp_max_nr_conflicts_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_link_rt_tol_featurelinkerunlabeledkd_openms ? "-algorithm:link:rt_tol $params.algorithm_link_rt_tol_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_link_mz_tol_featurelinkerunlabeledkd_openms ? "-algorithm:link:mz_tol $params.algorithm_link_mz_tol_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_link_charge_merging_featurelinkerunlabeledkd_openms ? "-algorithm:link:charge_merging $params.algorithm_link_charge_merging_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_link_adduct_merging_featurelinkerunlabeledkd_openms ? "-algorithm:link:adduct_merging $params.algorithm_link_adduct_merging_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_distance_rt_exponent_featurelinkerunlabeledkd_openms ? "-algorithm:distance_RT:exponent $params.algorithm_distance_rt_exponent_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_distance_rt_weight_featurelinkerunlabeledkd_openms ? "-algorithm:distance_RT:weight $params.algorithm_distance_rt_weight_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_distance_mz_exponent_featurelinkerunlabeledkd_openms ? "-algorithm:distance_MZ:exponent $params.algorithm_distance_mz_exponent_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_distance_mz_weight_featurelinkerunlabeledkd_openms ? "-algorithm:distance_MZ:weight $params.algorithm_distance_mz_weight_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_distance_intensity_exponent_featurelinkerunlabeledkd_openms ? "-algorithm:distance_intensity:exponent $params.algorithm_distance_intensity_exponent_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_distance_intensity_weight_featurelinkerunlabeledkd_openms ? "-algorithm:distance_intensity:weight $params.algorithm_distance_intensity_weight_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_distance_intensity_log_transform_featurelinkerunlabeledkd_openms ? "-algorithm:distance_intensity:log_transform $params.algorithm_distance_intensity_log_transform_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_lowess_span_featurelinkerunlabeledkd_openms ? "-algorithm:LOWESS:span $params.algorithm_lowess_span_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_lowess_num_iterations_featurelinkerunlabeledkd_openms ? "-algorithm:LOWESS:num_iterations $params.algorithm_lowess_num_iterations_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_lowess_delta_featurelinkerunlabeledkd_openms ? "-algorithm:LOWESS:delta $params.algorithm_lowess_delta_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_lowess_interpolation_type_featurelinkerunlabeledkd_openms ? "-algorithm:LOWESS:interpolation_type $params.algorithm_lowess_interpolation_type_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_lowess_extrapolation_type_featurelinkerunlabeledkd_openms ? "-algorithm:LOWESS:extrapolation_type $params.algorithm_lowess_extrapolation_type_featurelinkerunlabeledkd_openms":''

                ].flatten().unique(false).join(' ').trim()

                }
                ext.prefix ={  "${meta.id}" }

                    publishDir = [
                    path: { "${params.outdir}/linker/output" },
                    enabled: true
                ]

            }
            withName: 'PYOPENMS_CALCULATEBOUNDRIES' {
                ext.args   = {
                    [


                    params.algorithm_nr_partitions_featurelinkerunlabeledkd_openms ? "--nr_partitions $params.algorithm_nr_partitions_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_warp_mz_tol_featurelinkerunlabeledkd_openms ? "--mz_tol_wrap $params.algorithm_warp_mz_tol_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_link_mz_tol_featurelinkerunlabeledkd_openms ? "--mz_tol $params.algorithm_link_mz_tol_featurelinkerunlabeledkd_openms":'',
                    params.algorithm_mz_unit_featurelinkerunlabeledkd_openms ? "--mz_unit $params.algorithm_mz_unit_featurelinkerunlabeledkd_openms":''



                ].flatten().unique(false).join(' ').trim()

                }
                ext.prefix ={ ${meta.id} }

                    publishDir = [
                    path: { "${params.outdir}/PYOPENMS_CALCULATEBOUNDRIES/output" },
                    enabled: params.save_intermeds
                ]

            }
        withName: 'PYOPENMS_SPLIT' {
                ext.args   = {
                    [


                ].flatten().unique(false).join(' ').trim()

                }
                ext.prefix ={ ${meta.id} }

                    publishDir = [
                    path: { "${params.outdir}/PYOPENMS_SPLIT/output" },
                    enabled: params.save_intermeds
                ]

            }

        withName: 'PYOPENMS_LIBBUILDER' {
                        ext.args   = {
                            [

                    params.polarity ? "--polarity $params.polarity":''


                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ ${meta.id} }

                            publishDir = [
                            path: { "${params.outdir}/PYOPENMS_LIBBUILDER/output" },
                            enabled: params.save_intermeds
                        ]

                    }


                    withName: 'PYOPENMS_RELOADMAPS' {
                        ext.args   = {
                            [


                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/PYOPENMS_RELOADMAPS/output" },
                            enabled: params.save_intermeds
                        ]

                    }

                    withName: 'OPENMS_FEATUREFINDERMETABOIDENT' {
                        ext.args   = {
                            [

                            params.extract_mz_window_featurefindermetaboident_openms ? "-extract:mz_window $params.extract_mz_window_featurefindermetaboident_openms":'',
                            params.extract_rt_window_featurefindermetaboident_openms ? "-extract:rt_window $params.extract_rt_window_featurefindermetaboident_openms":'',
                            params.extract_n_isotopes_featurefindermetaboident_openms ? "-extract:n_isotopes $params.extract_n_isotopes_featurefindermetaboident_openms":'',
                            params.extract_isotope_pmin_featurefindermetaboident_openms ? "-extract:isotope_pmin $params.extract_isotope_pmin_featurefindermetaboident_openms":'',
                            params.detect_peak_width_featurefindermetaboident_openms ? "-detect:peak_width $params.detect_peak_width_featurefindermetaboident_openms":'',
                            params.detect_min_peak_width_featurefindermetaboident_openms ? "-detect:min_peak_width $params.detect_min_peak_width_featurefindermetaboident_openms":'',
                            params.detect_signal_to_noise_featurefindermetaboident_openms ? "-detect:signal_to_noise $params.detect_signal_to_noise_featurefindermetaboident_openms":'',
                            params.model_type_featurefindermetaboident_openms ? "-model:type $params.model_type_featurefindermetaboident_openms":'',
                            params.model_add_zeros_featurefindermetaboident_openms ? "-model:add_zeros $params.model_add_zeros_featurefindermetaboident_openms":'',
                            params.model_unweighted_fit_featurefindermetaboident_openms ? "-model:unweighted_fit":'',
                            params.model_no_imputation_featurefindermetaboident_openms ? "-model:no_imputation":'',
                            params.model_each_trace_featurefindermetaboident_openms ? "-model:each_trace":'',
                            params.model_check_min_area_featurefindermetaboident_openms ? "-model:check:min_area $params.model_check_min_area_featurefindermetaboident_openms":'',
                            params.model_check_boundaries_featurefindermetaboident_openms ? "-model:check:boundaries $params.model_check_boundaries_featurefindermetaboident_openms":'',
                            params.model_check_width_featurefindermetaboident_openms ? "-model:check:width $params.model_check_width_featurefindermetaboident_openms":'',
                            params.model_check_asymmetry_featurefindermetaboident_openms ? "-model:check:asymmetry $params.model_check_asymmetry_featurefindermetaboident_openms":'',
                            params.emgscoring_max_iteration_featurefindermetaboident_openms ? "-EMGScoring:max_iteration $params.emgscoring_max_iteration_featurefindermetaboident_openms":'',
                            params.emgscoring_init_mom_featurefindermetaboident_openms ? "-EMGScoring:init_mom":''

                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/requantification/output" },
                            enabled: true
                        ]

                    }
                    withName: 'PYOPENMS_MERGE' {
                        ext.args   = {
                            [


                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/requantification_merged/output" },
                            enabled: true
                        ]

                    }
                    withName: 'GENERAL_MERGEFILE' {
                        ext.args   = {
                            [


                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/GENERAL_MERGEFILE/output" },
                            enabled: params.save_intermeds
                        ]

                    }
                    withName: 'PYOPENMS_FILEMERGER' {
                        ext.args   = {
                            [

                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/PYOPENMS_FILEMERGER/output" },
                            enabled: params.save_intermeds
                        ]

                    }
                    withName: 'OPENMS_FILEFILTER' {
                        ext.args   = {
                            [

                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/OPENMS_FILEFILTER/output" },
                            enabled: params.save_intermeds
                        ]

                    }
                    withName: 'PYOPENMS_MSMAPPING' {
                        ext.args   = {
                            [

                            params.mz_tolerance_pyopenms ? "--mz_tolerance $params.mz_tolerance_pyopenms":'',
                            params.rt_tolerance_pyopenms ? "--rt_tolerance $params.rt_tolerance_pyopenms":'',
                            params.annotate_ids_with_subelements_pyopenms ? "--annotate_ids_with_subelements":'',
                            params.measure_from_subelements_pyopenms ? "--measure_from_subelements":''

                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/PYOPENMS_MSMAPPING/output" },
                            enabled: params.save_intermeds
                        ]

                    }
                    withName: 'PYOPENMS_GENERATESEARCHPARAMS' {
                        ext.args   = {
                            [

                            "--ion_select all",
                            "--ms1_data_from MS2",
                            params.ms2_use_feature_ionization ? "--use_feature_ionization":'',
                            params.ms2_feature_selection ? "--feature_selection $params.ms2_feature_selection":'',
                            params.ms2_normalized_intensity ? "--normalized_intensity":'',
                            params.ms2_iterations ? "--iterations $params.ms2_iterations":'',
                            params.ms2_ppm_map ? "--ppm_map $params.ms2_ppm_map":'',
                            params.polarity ? "--polarity $params.polarity":''



                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/PYOPENMS_GENERATESEARCHPARAMS/output" },
                            enabled: params.save_intermeds
                        ]

                    }
                    withName: 'SIRIUS_SEARCH' {
                        ext.args   = {
                            [


                            params.sirius_project_maxmz ?  "--project_maxmz $params.sirius_project_maxmz":'',
                            params.sirius_project_loglevel ?  "--project_loglevel $params.sirius_project_loglevel":'',
                            params.sirius_project_ignore_formula ?  "--project_ignore-formula ":'',
                            params.sirius_sirius_ppm_max ?  "--sirius_ppm-max $params.sirius_sirius_ppm_max":'',
                            params.sirius_sirius_ppm_max_ms2 ?  "--sirius_ppm-max-ms2 $params.sirius_sirius_ppm_max_ms2":'',
                            params.sirius_sirius_tree_timeout ?  "--sirius_tree-timeout $params.sirius_sirius_tree_timeout":'',
                            params.sirius_sirius_compound_timeout ?  "--sirius_compound-timeout $params.sirius_sirius_compound_timeout":'',
                            params.sirius_sirius_no_recalibration ?  "--sirius_no-recalibration ":'',
                            params.sirius_sirius_profile ?  "--sirius_profile $params.sirius_sirius_profile":'',
                            params.sirius_sirius_formulas ?  "--sirius_formulas $params.sirius_sirius_formulas":'',
                            params.sirius_sirius_ions_enforced ?  "--sirius_ions-enforced $params.sirius_sirius_ions_enforced":'',
                            params.sirius_sirius_candidates ?  "--sirius_candidates $params.sirius_sirius_candidates":'',
                            params.sirius_sirius_candidates_per_ion ?  "--sirius_candidates-per-ion $params.sirius_sirius_candidates_per_ion":'',
                            params.sirius_sirius_elements_considered ?  "--sirius_elements-considered $params.sirius_sirius_elements_considered":'',
                            params.sirius_sirius_elements_enforced ?  "--sirius_elements-enforced $params.sirius_sirius_elements_enforced":'',
                            params.sirius_sirius_no_isotope_score ?  "--sirius_no-isotope-score ":'',
                            params.sirius_sirius_no_isotope_filter ?  "--sirius_no-isotope-filter ":'',
                            params.sirius_sirius_ions_considered ?  "--sirius_ions-considered $params.sirius_sirius_ions_considered":'',
                            params.sirius_sirius_db ?  "--sirius_db $params.sirius_sirius_db":'',
                            params.sirius_runfid ?  "--runfid ":'',
                            params.sirius_runpassatutto ?  "--runpassatutto ":'',
                            params.sirius_fingerid_db ?  "--fingerid_db $params.sirius_fingerid_db":'',
                            params.sirius_sirius_solver ?  "--sirius_solver $params.sirius_sirius_solver":'',
                            params.sirius_email ?  "--email $params.sirius_email":'',
                            params.sirius_password ?  "--password $params.sirius_password":'',
                            "--executable sirius"



                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/SIRIUS_SEARCH/output" },
                            enabled: params.save_intermeds
                        ]

                    }
                    withName: 'MS2QUERY_CHECKMODELFILES' {
                        ext.args   = {
                            [


                            params.polarity ? "--select $params.polarity":''

                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "" }

                            publishDir = [
                            path: { "${params.outdir}/MS2QUERY_CHECKMODELFILES/output" },
                            enabled: params.save_intermeds
                        ]

                    }

                    withName: 'MS2QUERY_SEARCH' {
                        ext.args   = {
                            [
                            "--additional_metadata feature_id",
                            params.polarity ? "--ionmode $params.polarity":''

                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/MS2QUERY_SEARCH/output" },
                            enabled: params.save_intermeds
                        ]

                    }

                    withName: 'MS2QUERY_MODELTRAIN' {
                        ext.args   = {
                            [

                            params.polarity ? "--polarity $params.polarity":''

                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/MS2QUERY_MODELTRAIN/output" },
                            enabled: params.save_intermeds
                        ]

                    }
                    withName: 'MS2QUERY_DOWNLOADMODEL' {
                        ext.args   = {
                            [
                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/MS2QUERY_DOWNLOADMODEL/downloads" },
                            enabled: params.save_intermeds
                        ]

                    }
                    withName: 'MS2QUERY_MODELFULLTRAIN' {
                        ext.args   = {
                            [

                            params.polarity ? "--polarity $params.polarity":''

                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/MS2QUERY_MODELFULLTRAIN/output" },
                            enabled: params.save_intermeds
                        ]

                    }
                    withName: 'PYOPENMS_EXPORT' {
                        ext.args   = {
                            [



                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/TABLE_OUTPUT" },
                            enabled: true,
                            mode: "copy"
                        ]

                    }
                    withName: 'MS2QUERY_EXPORT' {
                        ext.args   = {
                            [



                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/MS2QUERY_EXPORT/output" },
                            enabled: params.save_intermeds
                        ]

                    }
                    withName: 'PYOPENMS_SPLITMGF' {
                        ext.args   = {
                            [

                            params.mgf_splitmgf_pyopenms ? "--num_parts $params.mgf_splitmgf_pyopenms":''


                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/PYOPENMS_SPLITMGF/output" },
                            enabled: params.save_intermeds
                        ]

                    }
                    withName: 'PYOPENMS_CONCTSV' {
                        ext.args   = {
                            [



                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/PYOPENMS_CONCTSV/output" },
                            enabled: params.save_intermeds
                        ]

                    }
                    withName: 'PYOPENMS_SPLITCONSENSUS' {
                        ext.args   = {
                            [

                            params.split_consensus_parts ? "--split_parts $params.split_consensus_parts":''

                        ].flatten().unique(false).join(' ').trim()

                        }
                        ext.prefix ={ "${meta.id}" }

                            publishDir = [
                            path: { "${params.outdir}/PYOPENMS_SPLITCONSENSUS/output" },
                            enabled: params.save_intermeds
                        ]

                    }


}
